<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>Huey-消息队列 | Hexo</title><meta name="description" content="环境依赖  Python2.7+ or Python3.4+  Huey 官网 Huey 简介一个轻量 Python2.7+ Python3.4+ 轻巧的消息队列. 功能说明huey 支持：  多进程，多线程或 greenlet 任务执行模型 安排任务在给定时间或在给定延迟后执行 安排重复任务，例如 crontab 自动重试失败的任务 任务优先级 任务结果存储 任务锁定 任务管道和链  不支持项:"><meta property="og:type" content="article"><meta property="og:title" content="Huey-消息队列"><meta property="og:url" content="http://fansichao.github.com/blog/BigData/bigdata-huey.md/index.html"><meta property="og:site_name" content="Fansichao Blog"><meta property="og:description" content="环境依赖  Python2.7+ or Python3.4+  Huey 官网 Huey 简介一个轻量 Python2.7+ Python3.4+ 轻巧的消息队列. 功能说明huey 支持：  多进程，多线程或 greenlet 任务执行模型 安排任务在给定时间或在给定延迟后执行 安排重复任务，例如 crontab 自动重试失败的任务 任务优先级 任务结果存储 任务锁定 任务管道和链  不支持项:"><meta property="og:locale"><meta property="article:published_time" content="2021-10-23T11:54:51.071Z"><meta property="article:modified_time" content="2021-10-23T11:54:51.071Z"><meta property="article:author" content="Fansichao"><meta property="article:tag" content="blog,"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://fansichao.github.com/blog/BigData/bigdata-huey.md/index.html"><link rel="alternate" href="/atom.xml" title="Fansichao Blog" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/blog/css/style.css"><link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/fansichao" target="_blank"><img class="img-circle img-rotate" src="/blog/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">fansichao</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">Data Engineer &amp; SSE &amp; CYO</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/blog/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/blog/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-repository"><a href="/blog/repository"><i class="icon icon-project"></i> <span class="menu-title">Repository</span></a></li><li class="menu-item menu-item-books"><a href="/blog/books"><i class="icon icon-book-fill"></i> <span class="menu-title">Books</span></a></li><li class="menu-item menu-item-links"><a href="/blog/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/blog/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/cofess" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle="tooltip" data-placement="top"><i class="icon icon-behance"></i></a></li><li><a href="/blog/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">Categories</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/bigdata/">bigdata</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/linux/">linux</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/module/">module</a><span class="category-list-count">41</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/module/docker/">docker</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/module/graph/">graph</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/module/grpah/">grpah</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/module/hexo/">hexo</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/python/">python</a><span class="category-list-count">26</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/python/data-structure/">data-structure</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/python/python-algorithm/">python-algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/python/python-%E5%86%85%E7%BD%AE%E5%8C%85/">python-内置包</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/python/python-%E5%9F%BA%E7%A1%80/">python-基础</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/python/python-%E8%BF%9B%E9%98%B6/">python-进阶</a><span class="category-list-count">13</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/web/">web</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/xxx/">xxx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span class="category-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tags</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Database/" rel="tag">Database</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Graph/" rel="tag">Graph</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Neo4j/" rel="tag">Neo4j</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/aaa/" rel="tag">aaa</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/bigdata/" rel="tag">bigdata</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/blog/" rel="tag">blog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/centos8/" rel="tag">centos8</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/data-structure/" rel="tag">data-structure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/docker/" rel="tag">docker</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/graph/" rel="tag">graph</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/gremlin/" rel="tag">gremlin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hadoop/" rel="tag">hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hbase/" rel="tag">hbase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hugegraph/" rel="tag">hugegraph</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/index/" rel="tag">index</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/linux/" rel="tag">linux</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/module/" rel="tag">module</a><span class="tag-list-count">43</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/python/" rel="tag">python</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/python-algorithm/" rel="tag">python-algorithm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/python-%E5%86%85%E7%BD%AE%E5%8C%85/" rel="tag">python-内置包</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/python-%E5%9F%BA%E7%A1%80/" rel="tag">python-基础</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/python-%E8%BF%9B%E9%98%B6/" rel="tag">python-进阶</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/scylladb/" rel="tag">scylladb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/shell/" rel="tag">shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/spark/" rel="tag">spark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/todo/" rel="tag">todo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/web/" rel="tag">web</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/" rel="tag">缓存机制</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/blog/tags/Database/" style="font-size:13.4px">Database</a> <a href="/blog/tags/Graph/" style="font-size:13.1px">Graph</a> <a href="/blog/tags/Neo4j/" style="font-size:13.4px">Neo4j</a> <a href="/blog/tags/aaa/" style="font-size:13px">aaa</a> <a href="/blog/tags/bigdata/" style="font-size:13.3px">bigdata</a> <a href="/blog/tags/blog/" style="font-size:13px">blog</a> <a href="/blog/tags/centos8/" style="font-size:13px">centos8</a> <a href="/blog/tags/data-structure/" style="font-size:13px">data-structure</a> <a href="/blog/tags/docker/" style="font-size:13.6px">docker</a> <a href="/blog/tags/graph/" style="font-size:13px">graph</a> <a href="/blog/tags/gremlin/" style="font-size:13px">gremlin</a> <a href="/blog/tags/hadoop/" style="font-size:13px">hadoop</a> <a href="/blog/tags/hbase/" style="font-size:13px">hbase</a> <a href="/blog/tags/hexo/" style="font-size:13px">hexo</a> <a href="/blog/tags/hugegraph/" style="font-size:13.1px">hugegraph</a> <a href="/blog/tags/index/" style="font-size:13.1px">index</a> <a href="/blog/tags/linux/" style="font-size:13.8px">linux</a> <a href="/blog/tags/module/" style="font-size:14px">module</a> <a href="/blog/tags/python/" style="font-size:13.9px">python</a> <a href="/blog/tags/python-algorithm/" style="font-size:13px">python-algorithm</a> <a href="/blog/tags/python-%E5%86%85%E7%BD%AE%E5%8C%85/" style="font-size:13.3px">python-内置包</a> <a href="/blog/tags/python-%E5%9F%BA%E7%A1%80/" style="font-size:13.5px">python-基础</a> <a href="/blog/tags/python-%E8%BF%9B%E9%98%B6/" style="font-size:13.7px">python-进阶</a> <a href="/blog/tags/scylladb/" style="font-size:13px">scylladb</a> <a href="/blog/tags/shell/" style="font-size:13px">shell</a> <a href="/blog/tags/spark/" style="font-size:13px">spark</a> <a href="/blog/tags/todo/" style="font-size:13.2px">todo</a> <a href="/blog/tags/web/" style="font-size:13.3px">web</a> <a href="/blog/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size:13.1px">大数据</a> <a href="/blog/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size:13px">消息队列</a> <a href="/blog/tags/%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/" style="font-size:13px">缓存机制</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/10/">October 2021</a><span class="archive-list-count">244</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/blog/categories/xxx/">xxx</a></p><p class="item-title"><a href="/blog/aaa.md/" class="title">aaa</a></p><p class="item-date"><time datetime="2021-10-24T03:43:28.000Z" itemprop="datePublished">2021-10-24</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/blog/resources.md/" class="title">(no title)</a></p><p class="item-date"><time datetime="2021-10-23T11:54:51.339Z" itemprop="datePublished">2021-10-23</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/blog/Tools/ml/google-course/readme.md/" class="title">Google 机器学习速成课程</a></p><p class="item-date"><time datetime="2021-10-23T11:54:51.339Z" itemprop="datePublished">2021-10-23</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/blog/Tools/ml/google-course/03%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B.md/" class="title">(no title)</a></p><p class="item-date"><time datetime="2021-10-23T11:54:51.288Z" itemprop="datePublished">2021-10-23</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/blog/Tools/ml/google-course/04%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%B3%BB%E7%BB%9F%E5%9C%A8%E7%8E%B0%E5%AE%9E%E4%B8%96%E7%95%8C%E9%87%8C%E7%9A%84%E5%BA%94%E7%94%A8.md/" class="title">(no title)</a></p><p class="item-date"><time datetime="2021-10-23T11:54:51.288Z" itemprop="datePublished">2021-10-23</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-BigData/bigdata-huey" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">Huey-消息队列</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/blog/BigData/bigdata-huey.md/" class="article-date"><time datetime="2021-10-23T11:54:51.071Z" itemprop="datePublished">2021-10-23</time> </a></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/blog/BigData/bigdata-huey.md/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p>环境依赖</p><ul><li>Python2.7+ or Python3.4+</li></ul><p><a target="_blank" rel="noopener" href="https://huey.readthedocs.io/en/latest/">Huey 官网</a></p><h2 id="Huey-简介"><a href="#Huey-简介" class="headerlink" title="Huey 简介"></a>Huey 简介</h2><p>一个轻量 Python2.7+ Python3.4+ 轻巧的消息队列.</p><h2 id="功能说明"><a href="#功能说明" class="headerlink" title="功能说明"></a>功能说明</h2><p>huey 支持：</p><ul><li>多进程，多线程或 greenlet 任务执行模型</li><li>安排任务在给定时间或在给定延迟后执行</li><li>安排重复任务，例如 crontab</li><li>自动重试失败的任务</li><li>任务优先级</li><li>任务结果存储</li><li>任务锁定</li><li>任务管道和链</li></ul><p>不支持项:</p><ul><li>Huey 服务异常,异常服务无法继续运行，需要重新运行。(根据任务队列进行运行。)</li><li>不支持彻底取消，即任务永不使用。</li><li>无法暂定任务。任务尚未开始时，可以取消和撤销，任务已经进行后，无法取消。</li><li>定时任务精准度为分钟，无法精确到秒。</li></ul><p>Huey 对象:</p><ul><li>Huey Huey 实例</li><li>TaskWrapper 不需要 TaskWrapper 直接创建实例。在 Huey.task()与 Huey.periodic_task() 装饰会自动创建相应的 TaskWrapper。</li><li>Task 所述 Task 类表示的函数的执行。任务的实例被序列化并排入队列以供使用者执行，消费者反序列化并执行任务功能</li><li>Result 结果</li></ul><p><a target="_blank" rel="noopener" href="https://huey.readthedocs.io/en/latest/consumer.html">Huey 启动参数</a>: 保证 huey 的稳定持续启动,附带 Worker 检查等参数</p><h2 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h2><h3 id="安装-Huey"><a href="#安装-Huey" class="headerlink" title="安装 Huey"></a>安装 Huey</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install huey</span><br></pre></td></tr></table></figure><h3 id="安装-Redis"><a href="#安装-Redis" class="headerlink" title="安装 Redis"></a>安装 Redis</h3><p>详见 “Module-Redis 文档”</p><h3 id="安装-Sqlite3"><a href="#安装-Sqlite3" class="headerlink" title="安装 Sqlite3"></a>安装 Sqlite3</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install sqlite -y</span><br></pre></td></tr></table></figure><h3 id="软件使用"><a href="#软件使用" class="headerlink" title="软件使用"></a>软件使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 Redis</span></span><br><span class="line">redis-server /etc/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Huey 命令</span></span><br><span class="line">huey_consumer.py huey_task.huey -l /var/<span class="built_in">log</span>/app.huey.log -k process -w 2 -q -c 100 -m 10 -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行 指定task任务</span></span><br><span class="line">python huey_main.py</span><br><span class="line"></span><br><span class="line">(env) [scfan@scfan huey]$ huey_consumer.py huey_main.huey -k process -w 2  1</span><br><span class="line"></span><br><span class="line">[2019-10-04 17:46:21,985] INFO:huey.consumer:11137:Huey consumer started with 2 process, PID 11137 at 2019-10-04 09:46:21.985333</span><br><span class="line">[2019-10-04 17:46:21,985] INFO:huey.consumer:11137:Scheduler runs every 1 second(s).</span><br><span class="line">[2019-10-04 17:46:21,985] INFO:huey.consumer:11137:Periodic tasks are enabled.</span><br><span class="line">[2019-10-04 17:46:21,986] INFO:huey.consumer:11137:The following commands are available:</span><br><span class="line">+ huey_task.add_numbers_10</span><br><span class="line">+ huey_task.add_numbers_20</span><br></pre></td></tr></table></figure><h2 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h2><h3 id="DENIED-Redis-is-running-in-protected-mode"><a href="#DENIED-Redis-is-running-in-protected-mode" class="headerlink" title="DENIED Redis is running in protected mode"></a>DENIED Redis is running in protected mode</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ResponseError: DENIED Redis is running <span class="keyword">in</span> protected mode because protected mode is enabled, no <span class="built_in">bind</span> address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just <span class="built_in">disable</span> protected mode sending the <span class="built_in">command</span> <span class="string">&#x27;CONFIG SET protected-mode no&#x27;</span> from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet <span class="keyword">if</span> you <span class="keyword">do</span> so. Use CONFIG REWRITE to make this change permanent. 2) Alternatively you can just <span class="built_in">disable</span> the protected mode by editing the Redis configuration file, and setting the protected mode option to <span class="string">&#x27;no&#x27;</span>, and <span class="keyword">then</span> restarting the server. 3) If you started the server manually just <span class="keyword">for</span> testing, restart it with the <span class="string">&#x27;--protected-mode no&#x27;</span> option. 4) Setup a <span class="built_in">bind</span> address or an authentication password. NOTE: You only need to <span class="keyword">do</span> one of the above things <span class="keyword">in</span> order <span class="keyword">for</span> the server to start accepting connections from the outside.</span><br><span class="line">[2019-10-04 10:31:51,683] ERROR:huey.consumer.Worker:32427:Error reading from queue</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/home/scfan/env/lib/python2.7/site-packages/huey/consumer.py&quot;</span>, line 94, <span class="keyword">in</span> loop</span><br><span class="line">    task = self.huey.dequeue()</span><br><span class="line">  File <span class="string">&quot;/home/scfan/env/lib/python2.7/site-packages/huey/api.py&quot;</span>, line 282, <span class="keyword">in</span> dequeue</span><br><span class="line">    data = self.storage.dequeue()</span><br><span class="line">  File <span class="string">&quot;/home/scfan/env/lib/python2.7/site-packages/huey/storage.py&quot;</span>, line 423, <span class="keyword">in</span> dequeue</span><br><span class="line">    timeout=self.read_timeout)[1]</span><br><span class="line">  File <span class="string">&quot;/home/scfan/env/lib/python2.7/site-packages/redis/client.py&quot;</span>, line 1635, <span class="keyword">in</span> brpop</span><br><span class="line">    <span class="built_in">return</span> self.execute_command(<span class="string">&#x27;BRPOP&#x27;</span>, *keys)</span><br><span class="line">  File <span class="string">&quot;/home/scfan/env/lib/python2.7/site-packages/redis/client.py&quot;</span>, line 839, <span class="keyword">in</span> execute_command</span><br><span class="line">    <span class="built_in">return</span> self.parse_response(conn, command_name, **options)</span><br><span class="line">  File <span class="string">&quot;/home/scfan/env/lib/python2.7/site-packages/redis/client.py&quot;</span>, line 853, <span class="keyword">in</span> parse_response</span><br><span class="line">    response = connection.read_response()</span><br><span class="line">  File <span class="string">&quot;/home/scfan/env/lib/python2.7/site-packages/redis/connection.py&quot;</span>, line 717, <span class="keyword">in</span> read_response</span><br><span class="line">    raise response</span><br><span class="line">ResponseError: DENIED Redis is running <span class="keyword">in</span> protected mode because protected mode is enabled, no <span class="built_in">bind</span> address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just <span class="built_in">disable</span> protected mode sending the <span class="built_in">command</span> <span class="string">&#x27;CONFIG SET protected-mode no&#x27;</span> from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet <span class="keyword">if</span> you <span class="keyword">do</span> so. Use CONFIG REWRITE to make this change permanent. 2) Alternatively you can just <span class="built_in">disable</span> the protected mode by editing the Redis configuration file, and setting the protected mode option to <span class="string">&#x27;no&#x27;</span>, and <span class="keyword">then</span> restarting the server. 3) If you started the server manually just <span class="keyword">for</span> testing, restart it with the <span class="string">&#x27;--protected-mode no&#x27;</span> option. 4) Setup a <span class="built_in">bind</span> address or an authentication password. NOTE: You only need to <span class="keyword">do</span> one of the above things <span class="keyword">in</span> order <span class="keyword">for</span> the server to start accepting connections from the outside.</span><br></pre></td></tr></table></figure><p><strong>解决方法:</strong> Redis 服务处于保护模式, 需要修改配置文件 redis.conf。<br>将 NETWORK 下的 protected-mode yes 修改为 protected-mode no，然后重启 Redis 服务.</p><h3 id="The-TCP-backlog-setting-of-511-cannot-be-enforced-because-proc-sys-net-core-somaxconn-is-set-to-the-lower-value-of-128"><a href="#The-TCP-backlog-setting-of-511-cannot-be-enforced-because-proc-sys-net-core-somaxconn-is-set-to-the-lower-value-of-128" class="headerlink" title="The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128"></a>The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128</h3><p>日志信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis启动警告问题：WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is <span class="built_in">set</span> to the lower value of 128.</span><br></pre></td></tr></table></figure><p>解决方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时修改</span></span><br><span class="line"><span class="built_in">echo</span> 511 &gt; /proc/sys/net/core/somaxconn</span><br><span class="line"><span class="comment"># 永久修改</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.core.somaxconn= 1024&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="comment"># 使其生效</span></span><br><span class="line">sysctl -p</span><br><span class="line"><span class="comment"># 重启 Redis 服务</span></span><br></pre></td></tr></table></figure></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="http://fansichao.github.com/blog/BigData/bigdata-huey.md/" title="Huey-消息队列" target="_blank" rel="external">http://fansichao.github.com/blog/BigData/bigdata-huey.md/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/fansichao" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/blog/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/fansichao" target="_blank"><span class="text-dark">fansichao</span><small class="ml-1x">Data Engineer &amp; SSE &amp; CYO</small></a></h3><div>个人简介。</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/blog/BigData/bigdata-hive.md/" title="Hive"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/blog/BigData/bigdata-kafka.md/" title="Kafka学习之路"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>Maybe you could buy me a cup of coffee.</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/blog/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/blog/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/cofess" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle="tooltip" data-placement="top"><i class="icon icon-behance"></i></a></li><li><a href="/blog/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/blog/js/plugin.min.js"></script><script src="/blog/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/blog/",CONTENT_URL:"/blog/content.json"}</script><script src="/blog/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script><script>$(document).ready(function(){$("article img").not("[hidden]").not(".panel-body img").each(function(){var a,t,n=$(this),e=n.attr("alt"),r=n.parent("a");r.length<1&&(-1!=(t=(a=this.getAttribute("src")).lastIndexOf("?"))&&(a=a.substring(0,t)),r=n.wrap('<a href="'+a+'"></a>').parent("a")),r.attr("data-fancybox","images"),e&&r.attr("data-caption",e)}),$().fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1})})</script></body></html>